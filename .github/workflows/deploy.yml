name: CI using GitHub Actions & Docker

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    # -------------------------------------------
    # Test Client
    # -------------------------------------------
    - name: Setup Node for Client
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'
        cache-dependency-path: client/package-lock.json
        
    - name: Install Client Deps
      run: |
        cd client
        npm install
        
    - name: Build Client
      run: |
        cd client
        npm run build

    # -------------------------------------------
    # Test Server
    # -------------------------------------------
    - name: Install Server Deps
      run: |
        cd server
        npm install
        
    # Add 'npm test' if you add tests later
    # - name: Test Server
    #   run: |
    #     cd server
    #     npm test

    # -------------------------------------------
    # Test AI Engine
    # -------------------------------------------
    - name: Setup Python for AI Engine
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        cache: 'pip'
        
    - name: Install AI Engine Deps
      run: |
        cd ai-engine
        pip install -r requirements.txt
        
    # Add pytest here if needed
